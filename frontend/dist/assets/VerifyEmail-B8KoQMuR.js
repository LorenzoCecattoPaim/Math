import{c as A,f as D,a as z,b as B,u as F,r as s,j as e,L as G,d as v,e as P}from"./index-BHZVmxCX.js";import{B as C}from"./button-YsjuXer5.js";import{L as T,I as _}from"./label-DvjiGtI9.js";import{A as $}from"./arrow-left-B_lEUGrZ.js";import"./index-BOSJV_w5.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=A("ShieldCheck",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);function W(){const[c]=D(),d=z(),{toast:i}=B(),{verifyGoogleEmailCode:S,verifyGoogleMagicLink:x}=F(),r=c.get("pending_token")||"",l=c.get("magic_token")||"",L=c.get("email")||"",[u,E]=s.useState(""),[h,w]=s.useState(!1),[I,j]=s.useState(!!l),[k,b]=s.useState(!1),[n,y]=s.useState(60),[q,g]=s.useState(0),[o,f]=s.useState(null);s.useEffect(()=>{if(!l){j(!1);return}(async()=>{const{error:a}=await x(l);if(j(!1),a){i({variant:"destructive",title:"Link invalido",description:a.message});return}i({title:"Email verificado",description:"Login concluido com sucesso."}),d("/dashboard")})()},[l,d,i,x]),s.useEffect(()=>{if(n<=0)return;const t=window.setInterval(()=>{y(a=>Math.max(0,a-1))},1e3);return()=>window.clearInterval(t)},[n]),s.useEffect(()=>{if(!o)return;if(Date.now()>=o){f(null),g(0);return}const a=window.setInterval(()=>{Date.now()>=o&&(f(null),g(0))},1e3);return()=>window.clearInterval(a)},[o]);const m=o?Math.max(0,Math.ceil((o-Date.now())/1e3)):0,M=async()=>{if(!r){i({variant:"destructive",title:"Sessao de verificacao invalida",description:"Inicie o login com Google novamente."});return}if(!(n>0||m>0)){b(!0);try{const t=await P.resendVerificationCode(r),a=t.pending_token||r,p=new URLSearchParams(c);p.set("pending_token",a),t.email&&p.set("email",t.email),d(`/verify-email?${p.toString()}`,{replace:!0}),y(60),g(V=>{const N=V+1;return N>=5&&f(Date.now()+60*60*1e3),N}),i({title:"Codigo reenviado",description:t.message||"Novo codigo enviado para seu email."})}catch(t){i({variant:"destructive",title:"Falha ao reenviar",description:t.message})}finally{b(!1)}}},R=async t=>{if(t.preventDefault(),!r){i({variant:"destructive",title:"Sessao de verificacao invalida",description:"Inicie o login com Google novamente."});return}if(!/^[0-9]{6}$/.test(u.trim())){i({variant:"destructive",title:"Codigo invalido",description:"Informe um codigo numerico de 6 digitos."});return}w(!0);const{error:a}=await S(r,u);if(w(!1),a){i({variant:"destructive",title:"Nao foi possivel validar o codigo",description:a.message});return}i({title:"Email verificado",description:"Login concluido com sucesso."}),d("/dashboard")};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background px-6",children:e.jsxs("div",{className:"w-full max-w-md rounded-2xl border bg-card p-8 shadow-md",children:[e.jsxs(G,{to:"/register",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground mb-6 transition-colors",children:[e.jsx($,{className:"w-4 h-4"}),"Voltar"]}),e.jsxs("div",{className:"mb-6 space-y-2",children:[e.jsx("div",{className:"inline-flex h-10 w-10 items-center justify-center rounded-full bg-primary/10 text-primary",children:e.jsx(U,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-2xl font-bold",children:"Verificar Email"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Enviamos um link e um codigo de 6 digitos para ",L||"seu email","."]})]}),I?e.jsxs("div",{className:"rounded-lg border bg-muted/40 p-4 text-sm text-muted-foreground flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Validando link automaticamente..."]}):e.jsxs("form",{onSubmit:R,className:"space-y-5",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(T,{htmlFor:"verificationCode",children:"Codigo"}),e.jsx(_,{id:"verificationCode",type:"text",inputMode:"numeric",maxLength:6,placeholder:"000000",value:u,onChange:t=>E(t.target.value.replace(/\D/g,"")),className:"h-12 text-center tracking-[0.35em] text-lg",required:!0})]}),e.jsx(C,{type:"submit",className:"w-full",size:"lg",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Confirmando..."]}):"Confirmar codigo"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(C,{type:"button",variant:"outline",className:"w-full",disabled:k||n>0||m>0,onClick:M,children:k?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"w-4 h-4 animate-spin"}),"Reenviando..."]}):n>0?`Reenviar codigo em ${n}s`:m>0?`Reenvio bloqueado por ${m}s`:"Reenviar codigo"}),e.jsx("p",{className:"text-xs text-muted-foreground text-center",children:"Voce pode reenviar ate 5 vezes por hora."})]})]})]})})}export{W as default};
